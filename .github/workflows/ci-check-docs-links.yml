name: "CI: Check Docs Links"

on:
  pull_request:
    paths:
      - "docs/content/**"
      - "docs/src/**"
      - "scripts/docs-generators/check-links.ts"

jobs:
  check-links:
    name: Check Documentation Links
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install pnpm
        uses: pnpm/action-setup@v4

      - name: Install dependencies
        run: pnpm install
        working-directory: docs

      - name: Check internal links
        run: npx tsx scripts/docs-generators/check-links.ts
        working-directory: .

      - name: Show help if check failed
        if: failure()
        run: |
          echo ""
          echo "╔══════════════════════════════════════════════════════════════════╗"
          echo "║                    Broken Documentation Links!                    ║"
          echo "╠══════════════════════════════════════════════════════════════════╣"
          echo "║                                                                  ║"
          echo "║  One or more internal links in the documentation are broken.     ║"
          echo "║                                                                  ║"
          echo "║  To find broken links locally, run from the repository root:     ║"
          echo "║                                                                  ║"
          echo "║    npx tsx scripts/docs-generators/check-links.ts               ║"
          echo "║                                                                  ║"
          echo "║  To also check external links:                                   ║"
          echo "║                                                                  ║"
          echo "║    npx tsx scripts/docs-generators/check-links.ts --external    ║"
          echo "║                                                                  ║"
          echo "╚══════════════════════════════════════════════════════════════════╝"
